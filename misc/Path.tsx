import { useDevice } from "@/provider/DeviceProvider";
import { motion } from "framer-motion";
import { useRef, useState, useEffect } from "react";

export default function JourneyPath() {
  const ref = useRef<SVGPathElement>(null);
  const [isInView, setInView] = useState(false);
  const device = useDevice();

  useEffect(() => {
    const el = ref.current;
    const container = document.querySelector("#container");
    function isInViewport() {
      if (el) {
        var rect = el.getBoundingClientRect();

        const isView =
          rect.top >= 0 &&
          rect.left >= 0 &&
          rect.bottom <=
            (window.innerHeight || document.documentElement.clientHeight) &&
          rect.right <=
            (window.innerWidth || document.documentElement.clientWidth);

        if (isView != false) setInView(isView);
      }
    }
    container?.addEventListener("scroll", isInViewport);
    return () => {
      container?.removeEventListener("scroll", isInViewport);
    };
  }, []);

  return (
    device == "desktop" && (
      <motion.svg
        id="svgpath"
        className="absolute top-0 left-0 pt-8"
        viewBox="0 0 1062 400"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        aria-label="Journey Path"
      >
        <>
          <motion.path
            ref={ref}
            className="z-0"
            transform="translate(0, 8)"
            id="pathjourney"
            d="M168.5 2H978.25C1023.4 2 1060 38.6007 1060 83.75V83.75C1060 128.899 1023.4 165.5 978.25 165.5H90.75C41.7348 165.5 2 205.235 2 254.25V254.25C2 303.265 41.7347 343 90.75 343H936"
            stroke="#D6BFB2"
            style={{
              stroke: "#D6BFB2",
              strokeOpacity: 1,
            }}
            initial={{ pathLength: 0 }}
            animate={{ pathLength: isInView ? 1 : 0 }}
            viewport={{ once: true }}
            transition={{
              delay: 2,
              duration: 12,
              type: "spring",
              bounce: 0.3,
              ease: "easeInOut",
            }}
            strokeWidth={3}
          />

          <motion.path
          transform="translate(0, 8)"
            initial={{ pathLength: 0 }}
            animate={{ pathLength: isInView ? 1 : 0 }}
            viewport={{ once: true }}
            transition={{
              delay: 5.4,
              duration: 1,
              type: "spring",
              bounce: 0.3,
              ease: "easeInOut",
            }}
            d="M931 343H1010"
            stroke="url(#paint0_linear_138_7)"
            style={{}}
            strokeWidth={3}
            strokeDasharray="3.846, 1.282"
            strokeDashoffset="0"
          />

          <motion.g
            className="z-10"
            initial={{ opacity: 0 }}
            animate={{ opacity: isInView ? 1 : 0 }}
            viewport={{ once: true }}
            transition={{
              delay: 2,
              duration: 0.5,
              type: "spring",
              bounce: 0.2,
            }}
            transform="translate(100, 0)"
          >
            <path
              transform="translate(-30, 0)"
              d="M94.7091 1.2392C96.5266 -0.413067 99.4734 -0.413067 101.291 1.2392L107.637 7.0083C109.454 8.66057 109.454 11.3394 107.637 12.9917L101.291 18.7608C99.4734 20.4131 96.5266 20.4131 94.7091 18.7608L88.3631 12.9917C86.5456 11.3394 86.5456 8.66057 88.3631 7.0083L94.7091 1.2392Z"
              fill="#D6BFB2"
              style={{
                fill: "#D6BFB2",
                fillOpacity: 1,
              }}
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M260.094 4.38675C258.938 3.34439 257.062 3.34439 255.906 4.38675L255.631 4.63406H254.958C253.342 4.63406 252.032 5.81444 252.032 7.2705L252.032 7.87768L251.867 8.02627C250.711 9.06863 250.711 10.7586 251.867 11.801L252.032 11.9496V12.3545C252.032 13.8106 253.342 14.991 254.958 14.991H255.407L255.906 15.4405C257.062 16.4829 258.938 16.4829 260.094 15.4405L260.593 14.991H260.599C262.214 14.991 263.524 13.8106 263.524 12.3545V12.3492L264.133 11.801C265.289 10.7586 265.289 9.06863 264.133 8.02627L263.524 7.47802V7.2705C263.524 5.81444 262.214 4.63406 260.599 4.63406H260.369L260.094 4.38675Z"
              fill="#D6BFB2"
              style={{
                fill: "#D6BFB2",
                fillOpacity: 1,
              }}
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M131.094 167.51C129.938 166.468 128.062 166.468 126.906 167.51L126.768 167.634H125.958C124.342 167.634 123.032 168.814 123.032 170.271L123.032 171.001L122.867 171.15C121.711 172.192 121.711 173.882 122.867 174.925L123.032 175.073V175.355C123.032 176.811 124.342 177.991 125.958 177.991H126.27L126.906 178.564C128.062 179.606 129.938 179.606 131.094 178.564L131.733 177.988C133.242 177.927 134.453 176.835 134.521 175.475L135.133 174.925C136.289 173.882 136.289 172.192 135.133 171.15L134.524 170.602V170.271C134.524 168.814 133.214 167.634 131.599 167.634H131.232L131.094 167.51Z"
              fill="#D6BFB2"
              style={{
                fill: "#D6BFB2",
                fillOpacity: 1,
              }}
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M525.094 4.38675C523.938 3.34439 522.062 3.34439 520.906 4.38675L520.631 4.63406H519.958C518.342 4.63406 517.032 5.81444 517.032 7.2705L517.032 7.87768L516.867 8.02627C515.711 9.06863 515.711 10.7586 516.867 11.801L517.032 11.9496V12.3545C517.032 13.8106 518.342 14.991 519.958 14.991H520.407L520.906 15.4405C522.062 16.4829 523.938 16.4829 525.094 15.4405L525.593 14.991H525.599C527.214 14.991 528.524 13.8106 528.524 12.3545V12.3492L529.133 11.801C530.289 10.7586 530.289 9.06863 529.133 8.02627L528.524 7.47802V7.2705C528.524 5.81444 527.214 4.63406 525.599 4.63406H525.369L525.094 4.38675Z"
              fill="#D6BFB2"
              style={{
                fill: "#D6BFB2",
                fillOpacity: 1,
              }}
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M398.094 167.51C396.938 166.468 395.062 166.468 393.906 167.51L393.768 167.634H392.958C391.342 167.634 390.032 168.814 390.032 170.271L390.032 171.001L389.867 171.15C388.711 172.192 388.711 173.882 389.867 174.925L390.032 175.073V175.355C390.032 176.811 391.342 177.991 392.958 177.991H393.27L393.906 178.564C395.062 179.606 396.938 179.606 398.094 178.564L398.733 177.988C400.242 177.927 401.453 176.835 401.521 175.475L402.133 174.925C403.289 173.882 403.289 172.192 402.133 171.15L401.524 170.602V170.271C401.524 168.814 400.214 167.634 398.599 167.634H398.232L398.094 167.51Z"
              fill="#D6BFB2"
              style={{
                fill: "#D6BFB2",
                fillOpacity: 1,
              }}
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M790.094 4.38675C788.938 3.34439 787.062 3.34439 785.906 4.38675L785.631 4.63406H784.958C783.342 4.63406 782.032 5.81444 782.032 7.2705L782.032 7.87768L781.867 8.02627C780.711 9.06863 780.711 10.7586 781.867 11.801L782.032 11.9496V12.3545C782.032 13.8106 783.342 14.991 784.958 14.991H785.407L785.906 15.4405C787.062 16.4829 788.938 16.4829 790.094 15.4405L790.593 14.991H790.599C792.214 14.991 793.524 13.8106 793.524 12.3545V12.3492L794.133 11.801C795.289 10.7586 795.289 9.06863 794.133 8.02627L793.524 7.47802V7.2705C793.524 5.81444 792.214 4.63406 790.599 4.63406H790.369L790.094 4.38675Z"
              fill="#D6BFB2"
              style={{
                fill: "#D6BFB2",
                fillOpacity: 1,
              }}
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M657.094 167.51C655.938 166.468 654.062 166.468 652.906 167.51L652.768 167.634H651.958C650.342 167.634 649.032 168.814 649.032 170.271L649.032 171.001L648.867 171.15C647.711 172.192 647.711 173.882 648.867 174.925L649.032 175.073V175.355C649.032 176.811 650.342 177.991 651.958 177.991H652.27L652.906 178.564C654.062 179.606 655.938 179.606 657.094 178.564L657.733 177.988C659.242 177.927 660.453 176.835 660.521 175.475L661.133 174.925C662.289 173.882 662.289 172.192 661.133 171.15L660.524 170.602V170.271C660.524 168.814 659.214 167.634 657.599 167.634H657.232L657.094 167.51Z"
              fill="#D6BFB2"
              style={{
                fill: "#D6BFB2",
                fillOpacity: 1,
              }}
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M9.09419 345.782C7.9376 344.739 6.0624 344.739 4.90581 345.782L4.15191 346.461H3.95773C2.34209 346.461 1.03237 347.642 1.03237 349.098V349.273L0.867441 349.421C-0.289147 350.464 -0.289147 352.154 0.867441 353.196L1.03236 353.345L1.03236 354.182C1.03236 355.638 2.34209 356.818 3.95773 356.818H4.88651L4.90581 356.836C6.0624 357.878 7.9376 357.878 9.09419 356.836L9.11349 356.818H9.59891C11.2145 356.818 12.5243 355.638 12.5243 354.182V353.744L13.1326 353.196C14.2891 352.154 14.2891 350.464 13.1326 349.421L12.5128 348.863C12.3885 347.594 11.2672 346.584 9.85954 346.472L9.09419 345.782Z"
              fill="#D6BFB2"
              style={{
                fill: "#D6BFB2",
                fillOpacity: 1,
              }}
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M260.094 345.053C258.938 344.011 257.062 344.011 255.906 345.053L255.261 345.634H254.958C253.342 345.634 252.032 346.814 252.032 348.271V348.544L251.867 348.693C250.711 349.735 250.711 351.425 251.867 352.467L252.032 352.616L252.032 353.355C252.032 354.811 253.342 355.991 254.958 355.991H255.777L255.906 356.107C257.062 357.149 258.938 357.149 260.094 356.107L260.223 355.991H260.599C262.214 355.991 263.524 354.811 263.524 353.355V353.016L264.133 352.467C265.289 351.425 265.289 349.735 264.133 348.693L263.521 348.141C263.448 346.788 262.244 345.702 260.742 345.637L260.094 345.053Z"
              fill="#D6BFB2"
              style={{
                fill: "#D6BFB2",
                fillOpacity: 1,
              }}
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M525.094 344.782C523.938 343.739 522.062 343.739 520.906 344.782L520.44 345.202H519.957C518.342 345.202 517.032 346.382 517.032 347.838V348.273L516.867 348.421C515.711 349.464 515.711 351.154 516.867 352.196L517.032 352.344L517.032 352.922C517.032 354.378 518.342 355.559 519.957 355.559H520.599L520.906 355.836C522.062 356.878 523.938 356.878 525.094 355.836L525.401 355.559H525.599C527.214 355.559 528.524 354.378 528.524 352.922V352.744L529.133 352.196C530.289 351.154 530.289 349.464 529.133 348.421L528.524 347.873V347.838C528.524 346.382 527.214 345.202 525.599 345.202H525.56L525.094 344.782Z"
              fill="#D6BFB2"
              style={{
                fill: "#D6BFB2",
                fillOpacity: 1,
              }}
            />
            <circle
              cx={864}
              cy={350}
              transform="translate(-25, 0)"
              r={13.5}
              stroke="#D6BFB2"
              fill="#141414"
              strokeWidth={3}
            />
          </motion.g>
          <defs>
            <linearGradient
              id="paint0_linear_138_7"
              x1={931}
              y1={343.5}
              x2={1010}
              y2={343.5}
              gradientUnits="userSpaceOnUse"
            >
              <stop
                stopColor="#D6BFB2"
                style={{
                  stopColor: "#D6BFB2",
                  stopOpacity: 1,
                }}
              />
              <stop
                offset={1}
                stopColor="#70645D"
                stopOpacity={0}
                style={{
                  stopColor: "none",
                  stopOpacity: 0,
                }}
              />
            </linearGradient>
          </defs>
        </>
      </motion.svg>
    )
  );
}
